<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add Medicine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #d0e7ff, #ffffff);
            min-height: 100vh;
        }
        .card {
            border-radius: 20px;
        }
        .form-label {
            font-weight: 600;
        }
        .btn-success {
            border-radius: 50px;
            padding: 0.5rem 1.5rem;
        }
        .btn-secondary {
            border-radius: 50px;
            padding: 0.5rem 1.5rem;
        }
        #alertBox {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            border-radius: 15px;
        }
        .form-control, .form-select {
            border-radius: 10px;
        }
        .image-preview {
            display: none;
            margin-top: 10px;
            max-height: 150px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<th:block th:insert="AdminHeader.html"></th:block>
<div class="container mt-5 mb-5">
    <div class="card shadow-lg p-4">
        <div class="card-header bg-primary text-white rounded-top p-3 mb-3">
            <h3 class="mb-0"><i class="bi bi-plus-circle"></i> Add New Medicine</h3>
        </div>

        <div class="card-body">
            <div id="alertBox" class="alert alert-success alert-dismissible fade" style="display:none;">
                <span id="alertMessage"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <form id="addMedicineForm" th:action="@{/medicine/addMedicineForm}" method="post" enctype="multipart/form-data">
                <div class="row g-3">

                    <div class="col-md-6">
                        <label class="form-label">Name</label>
                        <label>
                            <input type="text" name="name" class="form-control" placeholder="Medicine Name" required>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Brand Name</label>
                        <label>
                            <input type="text" name="brandName" class="form-control" placeholder="Brand Name" required>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Category</label>
                        <label>
                            <select class="form-select" name="categoryName" required>
                                <option value="">----Select Category----</option>
                                <option value="Ka">Ka</option>
                                <option value="Kha">Kha</option>
                                <option value="Ga">Ga</option>
                                <option value="Gha">Gha</option>
                            </select>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Dosage Form</label>
                        <label>
                            <input type="text" name="dosageForm" class="form-control" placeholder="Tablet / Capsule / Syrup" required>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Strength</label>
                        <label>
                            <input type="text" name="strength" class="form-control" placeholder="500mg / 10ml" required>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Manufacturer</label>
                        <label>
                            <input type="text" name="manufacturer" class="form-control" placeholder="Manufacturer Name" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Batch Number</label>
                        <label>
                            <input type="text" name="batchNumber" class="form-control" placeholder="Batch #123" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Manufacture Date</label>
                        <label>
                            <input type="date" name="manufactureDate" class="form-control" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Expiry Date</label>
                        <label>
                            <input type="date" name="expiryDate" class="form-control" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Quantity in Stock</label>
                        <label>
                            <input type="number" name="quantityInStock" class="form-control" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Price</label>
                        <label>
                            <input type="number" step="0.01" name="price" class="form-control" required>
                        </label>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Description</label>
                        <label>
                            <textarea name="description" class="form-control" rows="1" placeholder="Short description" required></textarea>
                        </label>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Image</label>
                        <input type="file" name="image" class="form-control" accept="image/*" required>
                        <img id="imagePreview" class="image-preview" alt="medicineImage"/>
                    </div>

                </div>

                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> Save Medicine</button>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <a th:href="@{/medicine/backToList}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Back to List</a>
                </div>

            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        // Image preview
        $('input[name="image"]').change(function(e){
            const file = e.target.files[0];
            if(file){
                $('#imagePreview').attr('src', URL.createObjectURL(file)).show();
            }
        });

        $("#addMedicineForm").on("submit", function (e) {
            e.preventDefault();
            var formdata = new FormData(this);

            $.ajax({
                url: "/medicine/addMedicineForm",
                type: "POST",
                data: formdata,
                contentType: false,
                processData: false,
                success: function (response) {
                    $("#alertMessage").text(response.message); // set message
                    if (response.status === "success") {
                        $("#alertBox").removeClass("alert-danger").addClass("alert-success").fadeIn().addClass("show");

                        setTimeout(function () {
                            $("#alertBox").fadeOut();
                        }, 3000);

                        $("#addMedicineForm")[0].reset();
                        $('#imagePreview').hide();
                    } else if (response.status === "error") {
                        $("#alertBox").removeClass("alert-success").addClass("alert-danger").fadeIn().addClass("show");

                        setTimeout(function () {
                            $("#alertBox").fadeOut();
                        }, 3000);
                    }
                },
                error: function () {
                    alert("Something went wrong. Please try again!");
                }
            });
        });
    });
</script>

</body>
</html>
