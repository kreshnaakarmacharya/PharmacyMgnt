<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Manage Medicines - Pharmacy Admin</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/js/jquery-3.6.0.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/bootstrap-icons.css}">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .page-header {
            border-bottom: 3px solid #0d6efd;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .table-hover tbody tr:hover {
            background-color: #e9f2ff;
        }
        .btn {
            border-radius: 6px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        #alertBox {
            min-width: 250px;
            z-index: 1050;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .search-group .form-control {
            border-top-left-radius: 50px;
            border-bottom-left-radius: 50px;
        }
        .search-group .btn {
            border-top-right-radius: 50px;
            border-bottom-right-radius: 50px;
        }
        .card {
            border-radius: 12px;
        }
    </style>
</head>
<body>
<th:block th:insert="AdminHeader.html"></th:block>

<div class="container-fluid mt-4">
    <!-- Header and Search -->
    <div class="d-flex flex-wrap justify-content-between align-items-center page-header">
        <h2 class="text-primary mb-2 mb-md-0"><i class="bi bi-capsule-pill"></i> Manage Medicines</h2>
        <div class="d-flex flex-wrap align-items-center gap-2">
            <a href="/medicine/addMedicine" class="btn btn-success btn-lg">
                <i class="bi bi-plus-circle"></i> Add Medicine
            </a>
            <form th:action="@{/medicine/searchMedicine}" method="get" class="d-flex search-group">
                <div class="input-group">
                    <input type="text" id="search" name="keyword" th:value="${keyword}" class="form-control form-control-lg border-primary" placeholder="Search Medicine">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Box -->
    <div id="alertBox" class="alert alert-success alert-dismissible fade position-fixed top-0 end-0 mt-3 me-3" style="display:none;">
        <span id="alertMessage"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle text-center">
                    <thead class="table-primary">
                    <tr>
                        <th>S.N</th>
                        <th>Name</th>
                        <th>Brand</th>
                        <th>Category</th>
                        <th>Batch</th>
                        <th>Mfg Date</th>
                        <th>Expiry</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="med, iterStat : ${medicine}" id="row-[[${med.id}]]">
                        <td th:text="${iterStat.count}"></td>
                        <td th:text="${med.name}"></td>
                        <td th:text="${med.brandName}"></td>
                        <td th:text="${med.categoryName}"></td>
                        <td th:text="${med.batchNumber}"></td>
                        <td th:text="${#temporals.format(med.manufactureDate,'YYYY-MM-DD')}"></td>
                        <td th:text="${#temporals.format(med.expiryDate,'YYYY-MM-DD')}"></td>
                        <td th:text="${med.quantityInStock}"></td>
                        <td th:text="${med.price}"></td>
                        <td>
                            <a th:href="@{/medicine/view/{id}(id=${med.id})}" class="btn btn-info btn-sm mb-1">
                                <i class="bi bi-eye"></i> View
                            </a>
                            <a th:href="@{/medicine/editMedicine/{id}(id=${med.id})}" class="btn btn-warning btn-sm mb-1">
                                <i class="bi bi-pencil-square"></i> Edit
                            </a>
                            <button class="btn btn-danger btn-sm delete-btn mb-1" th:attr="data-id=${med.id}">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $(".delete-btn").click(function () {
            var id = $(this).data("id");
            if (!confirm("Are you sure you want to delete this medicine?")) return;

            $.ajax({
                url: "/medicine/deleteMedicine/" + id,
                type: "DELETE",
                success: function (response) {
                    if (response.status === "success") {
                        $("#row-" + id).remove();
                        $("#alertMessage").text(response.message);
                        $("#alertBox").fadeIn().addClass("show");
                        setTimeout(function () { location.reload(); }, 1000);
                    }
                },
                error: function () {
                    alert("Something went wrong. Please try again.");
                }
            });
        });
    });
</script>
</body>
</html>
